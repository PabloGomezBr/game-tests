<!doctype html>
<html lang="ca">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ofim√†tica SMX ‚Ä¢ BD ‚Ä¢ Models E/R i pas a taules</title>
  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#111b3a;
      --card:#0f1733cc;
      --stroke:#2b3a7a;
      --text:#eaf1ff;
      --muted:#a9b7e6;
      --good:#2ee59d;
      --bad:#ff4d6d;
      --warn:#ffd166;
      --shadow: 0 14px 40px rgba(0,0,0,.35);
      --radius: 18px;
      --speed: 160ms;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      overflow-x:hidden;
      background:
        radial-gradient(1200px 800px at 15% 20%, rgba(77,124,255,.35), transparent 60%),
        radial-gradient(900px 700px at 80% 35%, rgba(255,61,141,.25), transparent 60%),
        radial-gradient(1000px 800px at 50% 90%, rgba(46,229,157,.18), transparent 65%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      position:relative;
    }

    .grid{
      position:fixed; inset:0;
      background-image:
        linear-gradient(to right, rgba(255,255,255,.04) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.04) 1px, transparent 1px);
      background-size: 64px 64px;
      mask-image: radial-gradient(600px 400px at 50% 25%, black 30%, transparent 75%);
      opacity:.7;
      pointer-events:none;
      animation: drift 9s linear infinite;
    }
    @keyframes drift{ 0%{transform:translate3d(0,0,0)} 100%{transform:translate3d(-64px,-64px,0)} }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px 14px;
      position:relative;
      z-index:1;
    }
    .app{ width:min(980px, 100%); display:grid; gap:14px; }

    header{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      padding:14px 16px;
      border:1px solid rgba(255,255,255,.10);
      background:linear-gradient(180deg, rgba(15,23,51,.82), rgba(15,23,51,.52));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .brand{ display:flex; align-items:center; gap:12px; min-width:0; }
    .logo{
      width:44px; height:44px; border-radius:14px;
      background:
        radial-gradient(18px 18px at 30% 35%, rgba(255,255,255,.65), transparent 60%),
        linear-gradient(135deg, rgba(77,124,255,.95), rgba(255,61,141,.95));
      box-shadow: 0 10px 20px rgba(0,0,0,.35);
      position:relative; overflow:hidden;
    }
    .logo:after{
      content:""; position:absolute; inset:-30%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.35), transparent);
      transform: rotate(25deg);
      animation: shine 3.2s ease-in-out infinite;
    }
    @keyframes shine{ 0%,55%{transform:translateX(-60%) rotate(25deg)} 100%{transform:translateX(60%) rotate(25deg)} }

    .title{ display:flex; flex-direction:column; line-height:1.1; min-width:0; }
    .title b{font-size:14px; letter-spacing:.2px}
    .title span{font-size:12px; color:var(--muted); margin-top:3px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}

    .hud{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color:var(--text); font-size:12px; user-select:none;
    }
    .pill strong{font-variant-numeric: tabular-nums}

    .btn{
      cursor:pointer;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding:9px 12px;
      border-radius:12px;
      font-weight:700;
      font-size:12px;
      transition: transform var(--speed) ease, background var(--speed) ease, border-color var(--speed) ease;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.24)}
    .btn:active{transform: translateY(0px) scale(.99)}
    .btn.primary{
      border-color: rgba(77,124,255,.45);
      background: linear-gradient(135deg, rgba(77,124,255,.35), rgba(124,77,255,.28));
    }

    .stage{
      border:1px solid rgba(255,255,255,.10);
      background:linear-gradient(180deg, rgba(15,23,51,.80), rgba(15,23,51,.45));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
    }
    .progress{
      height:10px;
      background: rgba(255,255,255,.06);
      border-bottom:1px solid rgba(255,255,255,.08);
      position:relative;
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(46,229,157,.9), rgba(77,124,255,.9), rgba(255,61,141,.9));
      transition: width 200ms linear;
      filter: drop-shadow(0 0 10px rgba(46,229,157,.35));
    }
    .panel{ padding:16px; display:grid; gap:14px; }

    .card{
      border:1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      background: rgba(0,0,0,.10);
      padding:14px;
      display:grid;
      gap:10px;
      transform-origin: center;
      animation: pop .22s ease-out;
    }
    @keyframes pop{ from{transform: translateY(6px) scale(.985); opacity:.0} to{transform: translateY(0) scale(1); opacity:1} }

    .qhead{ display:flex; align-items:flex-start; gap:10px; justify-content:space-between; }
    .qmeta{ display:flex; gap:8px; flex-wrap:wrap; }
    .tag{
      font-size:11px; color:var(--muted);
      padding:6px 9px;
      border:1px solid rgba(255,255,255,.10);
      border-radius:999px;
      background: rgba(255,255,255,.04);
    }
    .question{ font-size:18px; font-weight:900; letter-spacing:.2px; margin:0; line-height:1.25; }
    .sub{ margin:0; color:var(--muted); font-size:12px; }

    .answers{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }
    @media (max-width:740px){ .answers{grid-template-columns: 1fr;} .question{font-size:17px} }

    .opt{
      position:relative;
      border-radius: 16px;
      padding:14px 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      overflow:hidden;
      user-select:none;
      transition: transform var(--speed) ease, border-color var(--speed) ease, background var(--speed) ease;
      min-height:58px;
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:900;
    }
    .opt:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.25); background: rgba(255,255,255,.09)}
    .opt:active{transform: translateY(0px) scale(.995)}
    .badge{
      width:26px; height:26px; border-radius:10px;
      display:grid; place-items:center; font-size:12px;
      color:rgba(255,255,255,.95);
      flex:0 0 auto;
      box-shadow: 0 10px 18px rgba(0,0,0,.25);
    }
    .c1{background: linear-gradient(135deg, rgba(255,61,141,.95), rgba(255,209,102,.55))}
    .c2{background: linear-gradient(135deg, rgba(77,124,255,.95), rgba(124,77,255,.55))}
    .c3{background: linear-gradient(135deg, rgba(124,77,255,.95), rgba(46,229,157,.55))}
    .c4{background: linear-gradient(135deg, rgba(46,229,157,.95), rgba(77,124,255,.55))}

    .opt.correct{ border-color: rgba(46,229,157,.65); background: rgba(46,229,157,.12); transform: translateY(-1px); }
    .opt.wrong{ border-color: rgba(255,77,109,.65); background: rgba(255,77,109,.10); }
    .opt.dim{opacity:.55}

    .footerRow{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      flex-wrap:wrap; color:var(--muted); font-size:12px;
    }
    .mini{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

    .center{
      text-align:center;
      padding:20px;
      display:grid;
      gap:12px;
    }
    .big{ font-size:28px; font-weight:1000; letter-spacing:.2px; margin:6px 0 0; }
    .lead{ margin:0; color:var(--muted); font-size:13px; line-height:1.4; }

    .grid2{ display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:10px; margin-top:6px; }
    @media (max-width:740px){.grid2{grid-template-columns:1fr}}
    .set{
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      text-align:left;
      display:grid;
      gap:8px;
    }
    label{font-size:12px; color:var(--muted)}
    select, input[type="number"]{
      width:100%;
      background: rgba(0,0,0,.25);
      color:var(--text);
      border:1px solid rgba(255,255,255,.14);
      border-radius:12px;
      padding:10px 10px;
      outline:none;
      font-weight:800;
    }
    .toggle{
      display:flex; align-items:center; gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      user-select:none;
    }
    .toggle input{accent-color: #6f8cff}

    #fx{ position:fixed; inset:0; pointer-events:none; z-index: 3; }
    .shake{ animation: shake 260ms ease-in-out; }
    @keyframes shake{
      0%{transform:translateX(0)}
      25%{transform:translateX(-6px)}
      55%{transform:translateX(5px)}
      80%{transform:translateX(-3px)}
      100%{transform:translateX(0)}
    }

    .toast{
      position:fixed; left:50%; bottom:18px;
      transform:translateX(-50%);
      background: rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 999px;
      padding:10px 14px;
      color:var(--text);
      font-size:12px;
      z-index: 4;
      opacity:0;
      pointer-events:none;
      transition: opacity 140ms ease, transform 140ms ease;
      backdrop-filter: blur(10px);
    }
    .toast.on{ opacity:1; transform: translateX(-50%) translateY(-2px); }
    code.inline{
      color:#eaf1ff;
      background:rgba(255,255,255,.06);
      padding:2px 6px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.10);
      font-weight:800;
    }
  </style>
</head>
<body>
  <div class="grid"></div>
  <canvas id="fx"></canvas>
  <div class="toast" id="toast"></div>

  <!-- M√∫sica opcional: posa un fitxer "music.mp3" al costat de l'HTML (o canvia el nom aqu√≠) -->
  <audio id="bgm" src="./../../music.mp3" loop preload="auto"></audio>

  <div class="wrap">
    <div class="app" role="application" aria-label="Kahoot BD Ofim√†tica">
      <header>
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div class="title">
            <b>Ofim√†tica SMX ‚Ä¢ Bases de dades</b>
            <span>Models E/R ‚Ä¢ Cardinalitats ‚Ä¢ Pas a taules (sense SQL)</span>
          </div>
        </div>
        <div class="hud">
          <div class="pill">Punts: <strong id="score">0</strong></div>
          <div class="pill">Ratxa: <strong id="streak">0</strong></div>
          <button class="btn" id="musicBtn" title="M√∫sica de fons">‚ô™ M√∫sica</button>
          <button class="btn" id="restartBtn" title="Reiniciar">‚Üª Reinicia</button>
        </div>
      </header>

      <section class="stage" aria-live="polite">
        <div class="progress"><div class="bar" id="bar"></div></div>
        <div class="panel" id="panel"></div>
      </section>
    </div>
  </div>

  <script>
    /***********************
     *  Pool 50 (Catal√†, dins nivell SMX GM)
     *  Temari: models E/R (1,2,3 relacions i tern√†ries), cardinalitats, pas a taules (PK/FK/atributs) sense SQL
     ***********************/
    const POOL = [
      {cat:"E/R", q:"En un model E/R, quina afirmaci√≥ descriu millor una entitat?", a:[
        "Un conjunt d'objectes del m√≥n real amb atributs comuns",
        "Una regla que uneix tres taules en una consulta",
        "Un camp que apunta sempre a una clau prim√†ria d'una altra taula",
        "Una propietat que nom√©s pot tenir valors num√®rics"
      ], c:0},

      {cat:"E/R", q:"Quin √©s l'objectiu principal d'una relaci√≥ en un E/R?", a:[
        "Representar l'associaci√≥ entre entitats",
        "Definir el tipus de dades de cada atribut",
        "Substituir la necessitat de claus prim√†ries",
        "Evitar que hi hagi atributs repetits"
      ], c:0},

      {cat:"Cardinalitats", q:"En una cardinalitat (1,N) entre A i B (mirant des d'A cap a B), quina lectura √©s correcta?", a:[
        "Un A pot associar-se amb molts B; un B s'associa amb un A",
        "Un A s'associa amb un B; un B s'associa amb molts A",
        "Un A s'associa amb molts B; un B tamb√© amb molts A",
        "Un A no pot associar-se mai amb B"
      ], c:0},

      {cat:"Cardinalitats", q:"Quina difer√®ncia clau hi ha entre (0,1) i (1,1)?", a:[
        "(0,1) √©s opcional; (1,1) √©s obligatori",
        "(0,1) √©s obligatori; (1,1) √©s opcional",
        "(0,1) vol dir molts; (1,1) vol dir un",
        "No hi ha cap difer√®ncia: s√≥n equivalents"
      ], c:0},

      {cat:"Cardinalitats", q:"Quan una relaci√≥ √©s (0,N), aix√≤ implica:", a:[
        "Pot no existir cap relaci√≥ o n'hi pot haver moltes",
        "Sempre hi ha exactament una relaci√≥",
        "Sempre hi ha com a m√≠nim una relaci√≥ i com a m√†xim una",
        "Hi ha com a m√≠nim dos registres relacionats"
      ], c:0},

      {cat:"Pas a taules", q:"Regla general: en una relaci√≥ 1:N, on s'acostuma a col¬∑locar la FK?", a:[
        "A la taula del costat N apuntant a la PK del costat 1",
        "A la taula del costat 1 apuntant a la PK del costat N",
        "En una tercera taula sempre",
        "No cal FK, nom√©s un atribut text"
      ], c:0},

      {cat:"Pas a taules", q:"En una relaci√≥ 1:1, una opci√≥ t√≠pica (no l'√∫nica) per implementar √©s:", a:[
        "Posar una FK en una de les dues taules i fer-la √∫nica",
        "Crear sempre una taula d'uni√≥ amb dues FKs",
        "Duplicar tots els atributs a les dues taules",
        "Convertir la relaci√≥ en 1:N autom√†ticament"
      ], c:0},

      {cat:"Pas a taules", q:"Per a una relaci√≥ N:M entre A i B, el pas habitual √©s:", a:[
        "Crear una taula d'uni√≥ amb dues FKs (i atributs de la relaci√≥ si n'hi ha)",
        "Posar una FK a A cap a B i ja est√†",
        "Posar una FK a B cap a A i ja est√†",
        "Unir les dues taules en una sola"
      ], c:0},

      {cat:"PK/FK", q:"Quina descripci√≥ encaixa millor amb una PK?", a:[
        "Atribut (o conjunt) que identifica un√≠vocament cada registre",
        "Atribut que sempre pot ser NULL",
        "Atribut que repeteix valors per agrupar registres",
        "Atribut que nom√©s existeix a taules d'uni√≥"
      ], c:0},

      {cat:"PK/FK", q:"Una FK serveix per:", a:[
        "Enlla√ßar registres entre taules mantenint la coher√®ncia referencial",
        "Fer que totes les consultes siguin m√©s r√†pides autom√†ticament",
        "Evitar que hi hagi cap valor repetit a la taula",
        "Convertir una relaci√≥ N:M en 1:1"
      ], c:0},

      {cat:"Relaci√≥ amb atributs", q:"Si una relaci√≥ t√© atributs propis (p.ex. data, quantitat), en el pas a taules aquests atributs van:", a:[
        "A la taula que representa la relaci√≥ (sobretot si √©s N:M o tern√†ria)",
        "Sempre a una de les entitats 'perqu√® s√≠'",
        "A totes dues entitats duplicats",
        "No es poden representar sense SQL"
      ], c:0},

      {cat:"Cardinalitats", q:"Si 'Client' i 'Comanda' √©s 1:N (un client fa moltes comandes), quina implementaci√≥ √©s m√©s coherent?", a:[
        "FK id_client dins de COMANDA apuntant a CLIENT",
        "FK id_comanda dins de CLIENT apuntant a COMANDA",
        "Taula CLIENT_COMANDA amb una sola FK",
        "Cap FK, nom√©s un camp 'nom_client' a COMANDA"
      ], c:0},

      {cat:"Cardinalitats", q:"Una relaci√≥ 0:1 entre A i B vol dir que per a un A:", a:[
        "Pot existir 0 o 1 B associat",
        "Sempre existeixen molts B associats",
        "Sempre existeix exactament 1 B associat",
        "Com a m√≠nim existeixen 2 B associats"
      ], c:0},

      {cat:"E/R", q:"Qu√® representa la 'participaci√≥' (opcional/obligat√≤ria) en una relaci√≥?", a:[
        "Si un registre pot existir sense estar relacionat",
        "Si un atribut √©s num√®ric o alfanum√®ric",
        "Si una taula necessita clau prim√†ria",
        "Si la relaci√≥ √©s tern√†ria o bin√†ria"
      ], c:0},

      {cat:"Pas a taules", q:"Quan una relaci√≥ 1:N t√© atributs (p.ex. 'dataAlta' en una assignaci√≥), la col¬∑locaci√≥ t√≠pica √©s:", a:[
        "A la taula del costat N, juntament amb la FK",
        "A la taula del costat 1, perqu√® √©s la 'principal'",
        "En una taula d'uni√≥ sempre, encara que sigui 1:N",
        "Com a PK de la taula del costat 1"
      ], c:0},

      {cat:"E/R", q:"Quina afirmaci√≥ √©s m√©s correcta sobre una relaci√≥ tern√†ria?", a:[
        "Implica simult√†niament tres entitats en una mateixa associaci√≥",
        "√âs el mateix que dues relacions 1:N independents",
        "No pot tenir atributs",
        "Sempre es pot transformar en 1:1 sense perdre informaci√≥"
      ], c:0},

      {cat:"Tern√†ries", q:"Implementaci√≥ habitual d'una relaci√≥ tern√†ria A-B-C:", a:[
        "Crear una taula amb tres FKs (cap a A, B i C) i els atributs de la relaci√≥",
        "Posar una FK a A i una altra a B, i ignorar C",
        "Crear dues taules d'uni√≥ i ja est√†, sempre equivalent",
        "Fusionar les tres entitats en una sola taula"
      ], c:0},

      {cat:"Tern√†ries", q:"Quan NO √©s equivalent substituir una tern√†ria per tres bin√†ries?", a:[
        "Quan la relaci√≥ dep√®n de la combinaci√≥ dels tres alhora (es perd restricci√≥)",
        "Quan les tres entitats tenen PK",
        "Quan hi ha atributs a les entitats",
        "Quan alguna entitat t√© m√©s d'un atribut"
      ], c:0},

      {cat:"N:M", q:"En una taula d'uni√≥ per a N:M, quina opci√≥ de PK √©s habitual?", a:[
        "PK composta per (FK_A, FK_B) si no hi ha identificador propi",
        "PK nom√©s FK_A, i FK_B no importa",
        "PK nom√©s FK_B, i FK_A no importa",
        "No cal PK en taules d'uni√≥"
      ], c:0},

      {cat:"N:M", q:"Si la relaci√≥ N:M t√© atribut propi (p.ex. 'hores' en ALUMNE-CURS), la PK composta segueix sent viable perqu√®:", a:[
        "L'atribut 'hores' no identifica; identifiquen les dues FKs",
        "Qualsevol atribut pot ser PK encara que vari√Ø",
        "√âs obligatori afegir una PK artificial sempre",
        "L'atribut propi s'ha de repetir a les entitats"
      ], c:0},

      {cat:"1:1", q:"En 1:1, quin criteri pr√†ctic ajuda a decidir on posar la FK?", a:[
        "Posar-la al costat amb participaci√≥ obligat√≤ria o amb menys registres",
        "Posar-la sempre al costat esquerre del dibuix",
        "Posar-la sempre al costat amb m√©s atributs",
        "Posar-la sempre en una taula d'uni√≥"
      ], c:0},

      {cat:"0:1", q:"Si A t√© una relaci√≥ 0:1 amb B i ho implementes amb FK a A, qu√® s'espera del valor FK quan no hi ha B?", a:[
        "Que sigui NULL (o buit) perqu√® √©s opcional",
        "Que sigui 0 perqu√® indica 'cap registre'",
        "Que sigui qualsevol valor aleatori",
        "Que sigui obligatori igualment"
      ], c:0},

      {cat:"1:N", q:"Relaci√≥ 1:N: si un registre del costat 1 s'elimina, qu√® pot passar amb els del costat N (conceptualment)?", a:[
        "Queden orfes si no es gestiona, perqu√® depenien de la FK",
        "S'eliminen sempre autom√†ticament per definici√≥ del model",
        "Canvien la seva PK per adaptar-se",
        "Es converteixen en entitats independents sense cap canvi"
      ], c:0},

      {cat:"E/R", q:"Quin error √©s t√≠pic quan es confon una relaci√≥ N:M amb una 1:N?", a:[
        "Intentar posar una sola FK i perdre m√∫ltiples associacions possibles",
        "Crear una taula d'uni√≥ i duplicar informaci√≥",
        "Fer una PK composta i perdre integritat",
        "Posar atributs a les entitats i no a la relaci√≥"
      ], c:0},

      {cat:"Pas a taules", q:"En una taula d'uni√≥, les FKs apunten a:", a:[
        "Les PKs de les dues (o tres) entitats que relaciona",
        "Qualsevol atribut que sigui num√®ric",
        "Els atributs 'nom' de les entitats",
        "La FK de la taula del costat N"
      ], c:0},

      {cat:"Cardinalitats", q:"Si un professor pot impartir 0..N m√≤duls, i cada m√≤dul l'imparteix 1 professor, la relaci√≥ √©s:", a:[
        "1:N (PROFESSOR ‚Üí M√íDUL) amb participaci√≥ opcional a professor",
        "N:M perqu√® un professor pot tenir molts m√≤duls",
        "1:1 perqu√® hi ha un professor per m√≤dul",
        "0:1 perqu√® √©s opcional"
      ], c:0},

      {cat:"Taules (escrit)", q:"Quan 'escriviu les taules' sense SQL, una definici√≥ m√≠nima correcta inclou:", a:[
        "Nom de taula + atributs + PK + FKs (i a qu√® apunten)",
        "Nom de taula + nom√©s atributs de text",
        "Nom de taula + PK, sense cap FK",
        "Nom de taula + consultes que s'hi faran"
      ], c:0},

      {cat:"Atributs", q:"Quin d'aquests √©s un error de modelatge b√†sic?", a:[
        "Guardar m√∫ltiples valors diferents en un sol atribut (p.ex. 'tel√®fons' en un camp)",
        "Definir una PK per a cada entitat",
        "Identificar relacions entre entitats",
        "Usar una taula d'uni√≥ per a N:M"
      ], c:0},

      {cat:"Cardinalitats", q:"Com es diferencia una relaci√≥ 1:N d'una N:M a l'hora de passar a taules?", a:[
        "1:N: FK al costat N; N:M: taula d'uni√≥",
        "1:N: taula d'uni√≥; N:M: FK al costat 1",
        "Totes dues es fan amb una FK al costat 1",
        "No hi ha difer√®ncia, nom√©s canvia el nom de la FK"
      ], c:0},

      {cat:"Relaci√≥ (atributs)", q:"Si 'Matr√≠cula' (data, nota) uneix ALUMNE i M√íDUL i un alumne pot matricular-se a molts m√≤duls, i un m√≤dul t√© molts alumnes, aix√≤ √©s:", a:[
        "N:M amb atributs de relaci√≥ (taula MATR√çCULA amb FK_alumne, FK_m√≤dul, data, nota)",
        "1:N amb FK dins d'ALUMNE cap a M√íDUL",
        "1:1 perqu√® hi ha data i nota",
        "Una tern√†ria obligat√≤ria"
      ], c:0},

      {cat:"3 relacions", q:"En un enunciat amb 3 entitats A, B i C i 2 relacions bin√†ries separades, qu√® √©s habitual?", a:[
        "Dues relacions independents cadascuna amb la seva regla (FK o taula d'uni√≥)",
        "Una √∫nica taula que contingui tot perqu√® s√≥n 3 entitats",
        "For√ßar una tern√†ria sempre",
        "Eliminar una relaci√≥ per simplificar"
      ], c:0},

      {cat:"Tern√†ries", q:"En una tern√†ria, quina combinaci√≥ sol identificar una ocurr√®ncia de la relaci√≥?", a:[
        "La combinaci√≥ de les tres FKs (o una PK artificial si es vol)",
        "Nom√©s la FK de la primera entitat",
        "Nom√©s l'atribut no clau 'data'",
        "La suma de les tres PKs"
      ], c:0},

      {cat:"1:1", q:"Si dues entitats tenen relaci√≥ 1:1 i decideixes fer una sola taula final, quan √©s m√©s raonable conceptualment?", a:[
        "Quan realment representen el mateix objecte i no t√© sentit separar-les",
        "Sempre √©s millor unir-les, sense excepci√≥",
        "Nom√©s quan √©s N:M",
        "Nom√©s si hi ha una tern√†ria"
      ], c:0},

      {cat:"Opcionalitat", q:"Si la participaci√≥ d'una entitat en una relaci√≥ √©s opcional (0..), aix√≤ afecta:", a:[
        "Si la FK pot quedar buida (NULL) en la implementaci√≥",
        "Si la PK pot repetir-se",
        "Si els atributs han de ser num√®rics",
        "Si √©s necessari fer una tern√†ria"
      ], c:0},

      {cat:"Pas a taules", q:"Una relaci√≥ 1:N sense atributs a la relaci√≥: quina √©s la informaci√≥ m√≠nima extra que afegeixes a la taula del costat N?", a:[
        "Una FK apuntant a la PK del costat 1",
        "Una nova PK per a tots els registres",
        "Un atribut text amb el nom del costat 1",
        "Una taula d'uni√≥ encara que no calgui"
      ], c:0},

      {cat:"Pas a taules", q:"En una N:M, si uses PK composta (FK_A, FK_B), qu√® passa si intentes repetir exactament la mateixa parella?", a:[
        "No es podria perqu√® la PK composta ho impediria (mateixa associaci√≥ duplicada)",
        "Es permet perqu√® les FKs no compten com PK",
        "Es permet per√≤ canvia la PK de les entitats",
        "Es converteix autom√†ticament en una tern√†ria"
      ], c:0},

      {cat:"Cardinalitats", q:"Quina lectura √©s correcta per a 'Cada comanda cont√© 1..N l√≠nies; cada l√≠nia pertany a 1 comanda'?", a:[
        "COMANDA (1) ‚Äî (N) L√çNIA amb participaci√≥ obligat√≤ria a l√≠nia i a comanda (m√≠nim 1 l√≠nia)",
        "N:M perqu√® hi ha moltes l√≠nies",
        "1:1 perqu√® cada l√≠nia √©s √∫nica",
        "0:1 perqu√® una comanda pot no tenir l√≠nies"
      ], c:0},

      {cat:"Enunciats", q:"Quan un enunciat diu 'pot tenir' i no diu 'sempre', aix√≤ sol apuntar a:", a:[
        "Participaci√≥ opcional (0..)",
        "Participaci√≥ obligat√≤ria (1..)",
        "Relaci√≥ sempre tern√†ria",
        "Que no cal modelar la relaci√≥"
      ], c:0},

      {cat:"Cardinalitats", q:"Si una entitat B ha d'estar relacionada obligat√≤riament amb A (1..1) i poses la FK a B, quin requisit conceptual tens?", a:[
        "La FK a B no pot quedar buida (√©s obligat√≤ria)",
        "La FK a B ha de ser una PK sempre",
        "La PK d'A ha de canviar-se",
        "B deixa de ser entitat"
      ], c:0},

      {cat:"Errors t√≠pics", q:"Quin distractor √©s m√©s t√≠pic en taules escrites quan hi ha N:M?", a:[
        "Oblidar la taula d'uni√≥ i posar una sola FK",
        "Posar PK a les entitats",
        "Anotar a qu√® apunten les FKs",
        "Separar atributs de cada entitat"
      ], c:0},

      {cat:"3 relacions", q:"Si tens un enunciat amb 3 entitats i exactament 3 relacions bin√†ries (una entre cada parella), aix√≤ vol dir necess√†riament:", a:[
        "Que NO √©s autom√†ticament tern√†ria: s√≥n tres relacions diferents",
        "Que √©s una tern√†ria i s'ha de fer una taula amb 3 FKs",
        "Que s'ha d'unir tot en una taula",
        "Que no poden existir cardinalitats"
      ], c:0},

      {cat:"Tern√†ries", q:"Qu√® √©s una trampa habitual quan es vol reempla√ßar una tern√†ria per tres bin√†ries?", a:[
        "Que poden apar√®ixer combinacions incoherents que la tern√†ria impedia",
        "Que sempre surten menys taules i aix√≤ √©s dolent",
        "Que no es poden fer FKs en bin√†ries",
        "Que les cardinalitats desapareixen"
      ], c:0},

      {cat:"Relaci√≥ (atributs)", q:"Si una relaci√≥ 1:N t√© atributs propis (p.ex. 'dataAssignaci√≥'), qu√® √©s m√©s coherent?", a:[
        "Posar aquests atributs a la taula del costat N junt amb la FK",
        "Posar-los a la taula del costat 1 perqu√® √©s el 'cap'",
        "Crear una taula d'uni√≥ sempre encara que no calgui",
        "Convertir la relaci√≥ en N:M"
      ], c:0},

      {cat:"Cardinalitats", q:"Quina opci√≥ descriu millor una relaci√≥ 1:1 amb opcionalitat a un costat?", a:[
        "Un registre d'un costat pot existir sense l'altre, per√≤ si existeix √©s √∫nic",
        "Cada costat sempre t√© molts registres relacionats",
        "Cap costat pot existir sense l'altre i poden ser molts",
        "No es pot implementar amb PK/FK"
      ], c:0},

      {cat:"Taules (escrit)", q:"Quan escrius la taula d'uni√≥ d'una N:M, qu√® √©s m√©s important que quedi clar?", a:[
        "Les dues FKs i a quines PK apunten (i la PK composta si s'usa)",
        "El tipus de dades exacte (VARCHAR, INT...)",
        "La consulta final en SQL",
        "La mida del disc on s'emmagatzema"
      ], c:0},

      {cat:"PK/FK", q:"Si una entitat no t√© cap atribut 'naturalment √∫nic', en nivell b√†sic √©s habitual:", a:[
        "Crear un identificador (ID) com a PK",
        "No posar PK i confiar en el nom",
        "Fer la PK amb tots els atributs de la taula",
        "Usar una FK d'una altra taula com a PK sempre"
      ], c:0},

      {cat:"Cardinalitats", q:"En una relaci√≥ 0..N, quin error de lectura √©s m√©s freq√ºent?", a:[
        "Confondre 0..N amb 1..N i fer-la obligat√≤ria",
        "Confondre 0..N amb 0..1 i fer-la √∫nica",
        "Confondre 0..N amb 1..1 i fer-la 1:1",
        "No dibuixar l'entitat perqu√® √©s opcional"
      ], c:0},

      {cat:"E/R", q:"Qu√® √©s m√©s coherent si un atribut dep√®n clarament de la relaci√≥ i no d'una entitat (p.ex. 'dataMatriculaci√≥')?", a:[
        "Tractar-lo com atribut de la relaci√≥ (i posar-lo a la taula que la representa)",
        "Posar-lo a l'entitat amb menys atributs",
        "Repetir-lo a totes dues entitats",
        "Convertir l'atribut en una entitat"
      ], c:0},

      {cat:"Tern√†ries", q:"En una tern√†ria amb atribut 'rol', on es col¬∑loca 'rol' en el pas a taules?", a:[
        "A la taula tern√†ria (la que t√© les 3 FKs)",
        "A l'entitat A perqu√® √©s la primera",
        "A l'entitat B perqu√® sol ser la principal",
        "A l'entitat C perqu√® ho demana la cardinalitat"
      ], c:0},

      {cat:"Rep√†s", q:"Quina correspond√®ncia √©s la m√©s correcta?", a:[
        "Entitat ‚Üí Taula; Atribut ‚Üí Camp; Relaci√≥ ‚Üí FK o taula d'uni√≥",
        "Entitat ‚Üí Camp; Atribut ‚Üí Taula; Relaci√≥ ‚Üí PK",
        "Entitat ‚Üí Relaci√≥; Atribut ‚Üí Tern√†ria; Relaci√≥ ‚Üí Atribut",
        "Entitat ‚Üí SQL; Atribut ‚Üí √çndex; Relaci√≥ ‚Üí Consulta"
      ], c:0}
    ];

    if (POOL.length !== 50) console.warn("POOL hauria de ser 50. Actual:", POOL.length);

    /***********************
     * Utilitats
     ***********************/
    const $ = (s)=>document.querySelector(s);
    const panel = $("#panel");
    const bar = $("#bar");
    const scoreEl = $("#score");
    const streakEl = $("#streak");
    const toastEl = $("#toast");
    const fx = $("#fx");
    const bgm = $("#bgm");

    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = (Math.random()*(i+1))|0;
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      return arr;
    }
    function clamp(n,a,b){return Math.max(a,Math.min(b,n));}
    function toast(msg){
      toastEl.textContent = msg;
      toastEl.classList.add("on");
      clearTimeout(toastEl._t);
      toastEl._t=setTimeout(()=>toastEl.classList.remove("on"),950);
    }

    // Beep SFX
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    let actx=null;
    function beep(type="good"){
      try{
        if(!actx) actx=new AudioCtx();
        const t0=actx.currentTime;
        const o=actx.createOscillator();
        const g=actx.createGain();
        o.type="triangle";
        o.frequency.value=(type==="good")?740:220;
        g.gain.setValueAtTime(0.0001,t0);
        g.gain.exponentialRampToValueAtTime(0.15,t0+0.01);
        g.gain.exponentialRampToValueAtTime(0.0001,t0+0.18);
        o.connect(g).connect(actx.destination);
        o.start(t0); o.stop(t0+0.2);
      }catch(e){}
    }

    // Confeti
    const confetti={
      parts:[], running:false,
      resize(){ fx.width=innerWidth*devicePixelRatio; fx.height=innerHeight*devicePixelRatio; },
      burst(x,y){
        this.resize();
        const N=110;
        for(let i=0;i<N;i++){
          this.parts.push({
            x:x*devicePixelRatio, y:y*devicePixelRatio,
            vx:(Math.random()*2-1)*8*devicePixelRatio,
            vy:(Math.random()*-1.2-0.2)*12*devicePixelRatio,
            g:0.55*devicePixelRatio,
            s:(Math.random()*3+2)*devicePixelRatio,
            a:1, r:Math.random()*Math.PI, vr:(Math.random()*2-1)*0.25
          });
        }
        if(!this.running){ this.running=true; requestAnimationFrame(()=>this.tick()); }
      },
      tick(){
        const ctx=fx.getContext("2d");
        ctx.clearRect(0,0,fx.width,fx.height);
        for(const p of this.parts){
          p.vy+=p.g; p.x+=p.vx; p.y+=p.vy; p.r+=p.vr; p.a*=0.985;
        }
        this.parts=this.parts.filter(p=>p.a>0.06 && p.y<fx.height+40*devicePixelRatio);
        for(const p of this.parts){
          ctx.save();
          ctx.globalAlpha=p.a;
          ctx.translate(p.x,p.y);
          ctx.rotate(p.r);
          ctx.fillStyle=`hsl(${(p.x+p.y)%360} 90% 60%)`;
          ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s*0.65);
          ctx.restore();
        }
        if(this.parts.length) requestAnimationFrame(()=>this.tick());
        else this.running=false;
      }
    };
    addEventListener("resize",()=>confetti.resize(),{passive:true});

    /***********************
     * Estat
     ***********************/
    const state={
      started:false,
      idx:0,
      total:20,
      score:0,
      streak:0,
      correct:0,          // % final
      streakMode:true,    // ON/OFF
      timerOn:false,
      timePerQ:12,
      timeLeft:0,
      tickId:null,
      questions:[]
    };

    function setBar(){
      const pct = state.started ? (state.idx/state.total)*100 : 0;
      bar.style.width = pct.toFixed(2)+"%";
    }

    function buildRun(total){
      const qs = shuffle(POOL.slice()); // preguntes sempre barrejades
      return qs.slice(0,total).map(q=>{
        const opts = q.a.map((txt,i)=>({txt,i}));
        shuffle(opts); // respostes barrejades
        const newC = opts.findIndex(o=>o.i===q.c);
        return {cat:q.cat,q:q.q,opts:opts.map(o=>o.txt),c:newC};
      });
    }

    function reset(){
      clearInterval(state.tickId);
      state.started=false;
      state.idx=0;
      state.score=0;
      state.streak=0;
      state.correct=0;
      state.questions=[];
      scoreEl.textContent="0";
      streakEl.textContent="0";
      setBar();
      renderStart();
    }

    /***********************
     * Pantalla inicial
     ***********************/
    function renderStart(){
      panel.innerHTML=`
        <div class="center">
          <div class="big">Mode Kahoot: <span style="background:linear-gradient(90deg,#2ee59d,#4d7cff,#ff3d8d); -webkit-background-clip:text; background-clip:text; color:transparent;">BD (E/R)</span></div>
          <p class="lead">
            Preguntes i respostes en <b>ordre aleatori</b>. Sense esperes: respons ‚Üí feedback ‚Üí seg√ºent.
            <br/>Dreceres: <span class="tag">1</span> <span class="tag">2</span> <span class="tag">3</span> <span class="tag">4</span>
          </p>

          <div class="grid2">
            <div class="set">
              <label for="count">Nombre de preguntes (pool = 50)</label>
              <select id="count">
                <option value="10">10</option>
                <option value="20" selected>20</option>
                <option value="30">30</option>
                <option value="50">50</option>
              </select>
              <div class="sub">Cada partida baralla preguntes i opcions autom√†ticament.</div>
            </div>

            <div class="set">
              <label>Mode ratxes</label>
              <div class="toggle" title="Activat: bonus per ratxa i (si hi ha) temps. Desactivat: cada encert = +100 fix">
                <input id="streakMode" type="checkbox" checked />
                <span>Activar ratxes (bonus)</span>
              </div>

              <label>Temporitzador (opcional)</label>
              <div class="toggle">
                <input id="timer" type="checkbox" />
                <span>Activar</span>
              </div>
              <label for="secs">Segons per pregunta</label>
              <input id="secs" type="number" min="5" max="30" step="1" value="12" />
            </div>
          </div>

          <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:6px">
            <button class="btn primary" id="startBtn">‚ñ∂ Comen√ßa</button>
          </div>

          <p class="lead">
            M√∫sica: bot√≥ <b>‚ô™ M√∫sica</b>. Si no sona, posa <span class="tag">music.mp3</span> al costat de l‚ÄôHTML.
          </p>
        </div>
      `;

      $("#startBtn").onclick=()=>{
        const total=parseInt($("#count").value,10);
        const timerOn=$("#timer").checked;
        const secs=clamp(parseInt($("#secs").value,10)||12,5,30);
        const streakMode=$("#streakMode").checked;
        start(total, timerOn, secs, streakMode);
      };
    }

    function start(total, timerOn, secs, streakMode){
      state.started=true;
      state.total=total;
      state.timerOn=timerOn;
      state.timePerQ=secs;
      state.streakMode=streakMode;
      state.idx=0;
      state.score=0;
      state.streak=0;
      state.correct=0;
      scoreEl.textContent="0";
      streakEl.textContent="0";
      state.questions=buildRun(total);
      setBar();
      renderQuestion();
      toast("Som-hi!");
    }

    function finish(){
      clearInterval(state.tickId);
      state.tickId=null;
      const pct = Math.round((state.correct/state.total)*100);
      panel.innerHTML=`
        <div class="center">
          <div class="big">üèÅ Final</div>
          <p class="lead">Puntuaci√≥ total: <b style="color:var(--good)">${state.score}</b> punts</p>
          <div class="card" style="text-align:left">
            <div class="qhead">
              <div class="qmeta">
                <span class="tag">Preguntes: ${state.total}</span>
                <span class="tag">Encerts: ${state.correct}</span>
                <span class="tag">Percentatge: ${pct}%</span>
              </div>
            </div>
            <p class="sub">Mode ratxes: <b>${state.streakMode ? "ON (bonus)" : "OFF (+100 fix)"}</b></p>
          </div>
          <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
            <button class="btn primary" id="againBtn">‚Üª Una altra</button>
          </div>
        </div>
      `;
      $("#againBtn").onclick=()=>reset();
    }

    /***********************
     * Preguntes
     ***********************/
    function renderQuestion(){
      clearInterval(state.tickId);
      state.tickId=null;

      if(state.idx>=state.total){ finish(); return; }

      const item=state.questions[state.idx];
      const n=state.idx+1;

      let timerHtml="";
      if(state.timerOn){
        state.timeLeft=state.timePerQ;
        timerHtml=`<span class="tag">‚è± <b id="tleft">${state.timeLeft}</b>s</span>`;
      }

      panel.innerHTML=`
        <div class="card" id="card">
          <div class="qhead">
            <div class="qmeta">
              <span class="tag">Pregunta ${n}/${state.total}</span>
              <span class="tag">${item.cat}</span>
              ${timerHtml}
              <span class="tag">Ratxes: <b>${state.streakMode ? "ON" : "OFF"}</b></span>
            </div>
            <div class="tag">+100 base</div>
          </div>

          <p class="question">${item.q}</p>
          <p class="sub">Tria una opci√≥ (o prem 1‚Äì4). Feedback immediat.</p>

          <div class="answers" id="answers">
            ${item.opts.map((t,i)=>`
              <div class="opt" data-i="${i}" role="button" tabindex="0" aria-label="Opci√≥ ${i+1}">
                <div class="badge ${["c1","c2","c3","c4"][i]}">${i+1}</div>
                <div>${t}</div>
              </div>
            `).join("")}
          </div>

          <div class="footerRow">
            <div class="mini">
              <span>Progr√©s</span>
              <span class="tag">${n}/${state.total}</span>
              <span style="opacity:.6">‚Ä¢</span>
              <span>Pista: pensa en regla de pas a taules (FK/taula d'uni√≥) i opcionalitat.</span>
            </div>
            <div class="mini">
              <span class="tag">Punts: <b id="score2">${state.score}</b></span>
              <span class="tag">Ratxa: <b id="streak2">${state.streak}</b></span>
            </div>
          </div>
        </div>
      `;

      const ans=$("#answers");
      const onPick=(i)=>handleAnswer(i);

      ans.querySelectorAll(".opt").forEach(el=>{
        el.addEventListener("click",()=>onPick(parseInt(el.dataset.i,10)));
        el.addEventListener("keydown",(e)=>{
          if(e.key==="Enter"||e.key===" "){ e.preventDefault(); onPick(parseInt(el.dataset.i,10)); }
        });
      });

      window.onkeydown=(e)=>{
        if(!state.started) return;
        const k=e.key;
        if(k>="1"&&k<="4"){
          const i=parseInt(k,10)-1;
          if(i>=0&&i<4) onPick(i);
        }
      };

      if(state.timerOn){
        const tEl=$("#tleft");
        state.tickId=setInterval(()=>{
          state.timeLeft--;
          if(tEl) tEl.textContent=state.timeLeft;
          if(state.timeLeft<=0){
            clearInterval(state.tickId);
            state.tickId=null;
            handleAnswer(-1,true);
          }
        },1000);
      }

      setBar();
    }

    function handleAnswer(choice,isTimeout=false){
      clearInterval(state.tickId);
      state.tickId=null;

      const item=state.questions[state.idx];
      const correct=item.c;
      const card=$("#card");
      const opts=[...document.querySelectorAll(".opt")];

      if(opts.some(o=>o.classList.contains("correct")||o.classList.contains("wrong"))) return;

      opts.forEach((o,i)=>{
        if(i===correct) o.classList.add("correct");
        if(choice===i && i!==correct) o.classList.add("wrong");
        if(choice!==i && i!==correct) o.classList.add("dim");
      });

      let gained=0;

      if(choice===correct){
        state.correct++;

        gained=100; // base sempre
        if(state.streakMode){
          state.streak++;
          gained += Math.min(60, state.streak*6);
          if(state.timerOn) gained += Math.max(0, (state.timeLeft|0)*3);
        } else {
          state.streak = 0;
        }

        state.score += gained;
        beep("good");

        scoreEl.textContent=String(state.score);
        streakEl.textContent=String(state.streak);
        $("#score2").textContent=String(state.score);
        $("#streak2").textContent=String(state.streak);

        const r=opts[correct].getBoundingClientRect();
        confetti.burst(r.left+r.width/2, r.top+r.height/2);
        toast(`‚úÖ Correcte +${gained}`);
      } else {
        state.streak=0;
        streakEl.textContent="0";
        if($("#streak2")) $("#streak2").textContent="0";
        beep("bad");
        card.classList.add("shake");
        toast(isTimeout ? "‚è∞ Temps!" : "‚ùå Incorrecte");
      }

      setTimeout(()=>{
        state.idx++;
        renderQuestion();
      },450);
    }

    /***********************
     * M√∫sica
     ***********************/
    let musicOn=false;
    $("#musicBtn").onclick=async ()=>{
      try{
        if(!musicOn){
          await bgm.play();
          musicOn=true;
          toast("‚ô™ M√∫sica ON");
          $("#musicBtn").classList.add("primary");
        } else {
          bgm.pause();
          musicOn=false;
          toast("‚ô™ M√∫sica OFF");
          $("#musicBtn").classList.remove("primary");
        }
      }catch(e){
        toast("No s'ha pogut reproduir. Afegeix music.mp3 al costat de l'HTML.");
      }
    };

    $("#restartBtn").onclick=()=>reset();

    // Inici
    reset();
  </script>
</body>
</html>
